# Тестовое Travel Solutions

## Результаты тестового задания.

### Задача

Реализовать приложение на Yii2 c использованием AR, выводящее весь список командировок с аэропортом вылета Домодедово,
Москва, для trip.coprorate_id = 3 и trip_service.service_id = 2*

### Результат

Можно проверить по ссылке
http://localhost//index.php?r=trip%2Findex&airport=Домодедово, Москва&corporate_id=3&service_id=2

---

### Задача

Приложение должно быть рассчитано на работу под нагрузкой как с большим объемом данных так и с большим количеством
обращений

### Результат

Реализовано кэширование запросов по названию аэропортов, так как эта таблица - справочник и каждый раз обращаться к БД
смысла нет.
По остальным данным нужно понимать частоту операций записи, критичность отставания кэша - кэширование не внедрял.

---

### Задача

Две базы данных:
• cbt (Дамп приложен в письме cbt.sql.gz)
• guide_etalon (Дамп приложен в письме nemo_guide_etalon.sql.gz)

### Результат

Созданы 2 БД.

---

### Задача

Выполнить миграцию исходных БД к виду на схеме. Скрипты миграций приложить.

### Результат

- Удалены лишние столбцы
- Удалены лишние индексы
- Поставлены нужные индексы
- Поставлены FK
- Сделаны миграции с up и down

---

### Задача

Параметры trip.coprorate_id = 3, trip_service.service_id = 2 и аэропорт вылета Домодедово, Москва должны приходить через
$GET запрос.

### Результат

Скрипт принимает праметры в _GET, делает проверку. Если параметры не переданы - выдает
html-страницу с шапкой и подвалам с заголовком Bad Request (#400) и текстом ошибки

---

### Задача
При необходимости выполнить оптимизация запросов индексов и т.д. Изменения внести в скрипты миграции
### Результат
Добавил индекс по value в списке аэропортов, так как у нас SELECT по нему.

---

## Структура

- /doc/ - документация
- /dockerfiles/ - файлы контейнеров
- /basic - Папка приложение YII2
- /basic/web - public папка. В нее смотрит nginx
- /.env - настройки окружения докер-сервиса

## Сборка проекта

### Сборка docker-сервиса

- Сбилдить контейнеры `docker-compose build`
- Создать volume `docker volume create ts-mysql-data`

### Запуск docker-сервиса

`docker-compose up -d`

### Сборка composer

- Проваливаемся в контейнер backned `docker exec -it ts-backend bash`
- Проваливаемся в папку /var/www `cd /var/www`
- Ставим пакеты `composer install`

### Создание БД

Нужно создать 2 БД: cbt и guide_etalon. В консоли MYSQL нужно выполнить команду

`CREATE DATABASE cbt`

`CREATE DATABASE guide_etalon`

Потом нужно залить дампы в соответствующие БД:

- doc/cbt.sql
- doc/nemo_guide_etalon.sql

## Структура приложения yii2

- `basic/` - корневой каталог приложения
    - `composer.json` - используется Composer'ом, содержит описание приложения
    - `config/` - конфигурационные файлы
        - `console.php` - конфигурация консольного приложения
        - `web.php` - конфигурация Web приложения
    - `commands/` - содержит классы консольных команд
- `controllers/` - контроллеры
- `models/` - модели
- `runtime/` - файлы, которые генерирует Yii во время выполнения приложения (логи, кэш и т.п.)
- `vendor/` - содержит пакеты Composer'а и, собственно, сам фреймворк Yii
- `views/` - виды приложения
- `web/` - корневая директория Web приложения. Содержит файлы, доступные через Web
    - `assets/` - скрипты, используемые приложением (js, css)
    - `index.php` - точка входа в приложение Yii. С него начинается выполнение приложения
- `yii` - скрипт выполнения консольного приложения Yii